# 1Ô∏è‚É£ Use Debian Slim base image (smaller than full Debian, includes necessary libs for Prisma)
FROM node:20-slim

# 2Ô∏è‚É£ Set working directory inside container
WORKDIR /app

# Install OpenSSL and other system dependencies for Prisma
RUN apt-get update && \
    apt-get install -y openssl libssl-dev libc6-dev g++ && \
    rm -rf /var/lib/apt/lists/*
    
# 3Ô∏è‚É£ Copy package files and tsconfig first for caching installs
COPY package.json package-lock.json* tsconfig.json ./

# 4Ô∏è‚É£ Install dependencies
RUN npm ci --production=false

# 5Ô∏è‚É£ Copy Prisma schema before generating client
COPY prisma ./prisma

# 6Ô∏è‚É£ Generate Prisma client (creates type-safe client for TS)
RUN npx prisma generate

# 7Ô∏è‚É£ Copy application source code
COPY src ./src

# 8Ô∏è‚É£ Build TypeScript to JS
RUN npm run build

# 9Ô∏è‚É£ Expose container port
EXPOSE 8002

# üîü Start the app
CMD ["npm", "start"]
